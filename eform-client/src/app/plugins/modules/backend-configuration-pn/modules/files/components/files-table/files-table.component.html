<mtx-grid
  [data]="_files.entities"
  [columns]="tableHeaders"
  [cellTemplate]="{select: selectTpl, id: idTpl, createDate: createDateTpl, fileName: fileNameTpl, property: propertyTpl, tags: tagsTpl, actions: actionsTpl}"
  [headerExtraTemplate]="selectHeaderTpl"
  [showPaginator]="false"
  [pageOnFront]="false"
  [rowStriped]="true"
  [showToolbar]="false"
  [showColumnMenuButton]="false"
  [sortActive]="selectFilesPaginationSort$ | async"
  [sortDirection]="selectFilesPaginationIsSortDsc$ | async"
  (sortChange)="onSortTable($event)"
  noResultText="{{'No files found' | translate}}"
>
</mtx-grid>

<ng-template #selectHeaderTpl let-col>
  <div *ngIf="col.field === 'select'" class="column-select">
    <mat-checkbox
      [indeterminate]="getIntermediateSelectedFiles"
      [ngModel]="allFileSelected"
      (ngModelChange)="selectAllFiles($event)"
    ></mat-checkbox>
  </div>
  <div *ngIf="col.field === 'actions'" class="column-actions">
    <button
      mat-icon-button
      color="primary"
      matTooltip="{{'Refresh table' | translate}}"
      (click)="updateTable.emit()">
      <mat-icon>refresh</mat-icon>
    </button>
  </div>
</ng-template>

<ng-template #selectTpl let-row>
  <div class="column-select">
    <mat-checkbox
      (change)="onChangeSelectedFiles(row)"
      [ngModel]="getSelectedFile(row)"
    ></mat-checkbox>
  </div>
</ng-template>

<ng-template #idTpl let-row let-i="index">
  <div class="fileId" id="fileId-{{i}}">{{ row.id }}</div>
</ng-template>

<ng-template #createDateTpl let-row let-i="index">
  <div class="fileCreateDate" id="fileCreateDate-{{i}}">{{ row.createDate | date:'dd.MM.yyyy HH:mm:ss' }}</div>
</ng-template>

<ng-template #fileNameTpl let-row let-i="index">
  <div class="fileName" id="fileName-{{i}}">{{ row.fileName }}.{{ row.fileExtension }}</div>
</ng-template>

<ng-template #propertyTpl let-row let-i="index">
  <div class="d-flex flex-wrap align-items-center">
    <mat-chip-list>
      <mat-chip *ngFor="let property of row.properties">
        <span>{{ property }}</span>
      </mat-chip>
    </mat-chip-list>
  </div>
</ng-template>

<ng-template #tagsTpl let-row let-i="index">
  <div class="d-flex flex-wrap align-items-center">
    <mat-chip-list>
      <mat-chip *ngFor="let tag of row.tags" color="primary" (click)="onClickTag(tag)">
        <span>{{ tag.name }}</span>
      </mat-chip>
    </mat-chip-list>
    <button
      mat-icon-button
      color="primary"
      id="editTagsBtn-{{i}}"
      matTooltip="{{'Edit tags file' | translate}}"
      (click)="openEditTags(row)">
      <mat-icon>edit</mat-icon>
    </button>
  </div>
</ng-template>

<ng-template #actionsTpl let-row let-i="index">
  <div class="files-actions" id="action-items-{{i}}">
    <button id="actionMenu" mat-icon-button [matMenuTriggerFor]="menu" matTooltip="{{ 'Actions' | translate }}">
      <mat-icon>more_vert</mat-icon>
    </button>

    <mat-menu #menu="matMenu">
      <button
        mat-menu-item
        id="viewPdfBtn-{{i}}"
        class="viewPdfBtn"
        (click)="onOpenView(row)"
      >
        <mat-icon>visibility</mat-icon>
        <span>{{ 'View File' | translate }}</span>
      </button>
      <button
        mat-menu-item
        id="editFilenameBtn-{{i}}"
        class="editFilenameBtn"
        (click)="onShowEditDocumentModal(row)"
      >
        <mat-icon color="accent">edit</mat-icon>
        <span>{{ 'Edit file name' | translate }}</span>
      </button>
      <button
        mat-menu-item
        id="deleteFileBtn-{{i}}"
        class="deleteFileBtn"
        (click)="onOpenDeleteModal(row)"
      >
        <mat-icon color="warn">delete</mat-icon>
        <span>{{ 'Delete file' | translate }}</span>
      </button>
    </mat-menu>
  </div>
</ng-template>
